version: '3.8'

services:
  ospos-db:
    image: mysql:8.0
    container_name: ospos-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ospos_root_password
      MYSQL_DATABASE: ospos
      MYSQL_USER: ospos_user
      MYSQL_PASSWORD: ospos_password
    volumes:
      - ospos_mysql_data:/var/lib/mysql
      - ./mysql-init:/docker-entrypoint-initdb.d
    networks:
      - ospos-network
    command: --default-authentication-plugin=mysql_native_password

  ospos-app:
    image: opensourcepos/opensourcepos:latest
    container_name: ospos-web
    restart: unless-stopped
    depends_on:
      - ospos-db
    environment:
      # Database Configuration
      DB_HOST: ospos-db
      DB_NAME: ospos
      DB_USER: ospos_user
      DB_PASSWORD: ospos_password
      DB_PORT: 3306
      
      # Application Configuration
      OSPOS_TIMEZONE: America/Mexico_City
      OSPOS_LANGUAGE: spanish
      
      # Security
      OSPOS_ENCRYPTION_KEY: your-32-character-encryption-key-here
      
      # Email Configuration (opcional)
      OSPOS_MAIL_PROTOCOL: smtp
      OSPOS_MAIL_HOST: smtp.gmail.com
      OSPOS_MAIL_PORT: 587
      OSPOS_MAIL_USERNAME: your-email@gmail.com
      OSPOS_MAIL_PASSWORD: your-app-password
      OSPOS_MAIL_CRYPTO: tls
    volumes:
      - ospos_uploads:/var/www/html/application/uploads
      - ospos_logs:/var/www/html/application/logs
    networks:
      - ospos-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ospos.rule=Host(`ospos.yourdomain.com`)"
      - "traefik.http.routers.ospos.tls=true"
      - "traefik.http.routers.ospos.tls.certresolver=letsencrypt"
      - "traefik.http.services.ospos.loadbalancer.server.port=80"

volumes:
  ospos_mysql_data:
    driver: local
  ospos_uploads:
    driver: local
  ospos_logs:
    driver: local

networks:
  ospos-network:
    driver: bridge